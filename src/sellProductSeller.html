<!DOCTYPE html>
<html lang="en">
<head>
  <title>Sell Product to Consumer | Fake Product Verification</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f7fa;
    }
    .navbar-brand span {
      font-size: 0.85rem;
      color: #adb5bd;
      display: block;
      margin-top: 2px;
    }
    .hero {
      background: linear-gradient(135deg, #1f3c73, #2b5876);
      color: white;
      padding: 60px 20px;
      text-align: center;
      border-radius: 0 0 20px 20px;
      margin-bottom: 40px;
    }
    .hero h1 {
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 0.3rem;
    }
    .form-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.05);
      padding: 30px;
      max-width: 900px;
      margin: 0 auto 40px auto;
    }
    label {
      font-weight: 600;
    }
    input.form-control:disabled {
      background-color: #e9ecef;
      opacity: 1;
    }
    .btn-custom {
      border-radius: 25px;
      padding: 10px 30px;
      font-weight: 600;
    }
    footer {
      background: #1b1e21;
      color: #ccc;
      text-align: center;
      padding: 20px;
      margin-top: 60px;
    }
    #postActionBtns button {
      margin: 0 10px;
      min-width: 160px;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand" href="#">
    Fake Product ID
    <span>Seller Portal</span>
  </a>
</nav>

<!-- Hero -->
<section class="hero">
  <div class="container">
    <h1>Sell Product to Consumer</h1>
    <p>Scan product QR and assign to consumer securely on blockchain.</p>
  </div>
</section>

<!-- Form Section -->
<section class="form-card">
  <div id="qr-reader" style="width: 300px; margin: 0 auto 25px;"></div>
  <div id="qr-reader-results" class="text-center mb-4 fs-5 fw-bold text-primary"></div>

  <form id="sellProductForm" class="row g-4 justify-content-center">
    <div class="col-md-6">
      <label for="productSN" class="form-label">Product Serial Number</label>
      <input type="text" id="productSN" name="productSN" class="form-control" disabled />
    </div>
    <div class="col-md-6">
      <label for="consumerCode" class="form-label">Consumer Code</label>
      <input type="text" id="consumerCode" name="consumerCode" class="form-control" placeholder="Enter Consumer Code" required />
    </div>
    <div class="col-12 text-center mt-3">
      <button type="submit" id="register" class="btn btn-warning btn-custom">Sell to Consumer</button>
      <div id="statusMessage" class="mt-3 fw-bold"></div>
      <div id="postActionBtns" class="mt-3" style="display:none;">
        <button type="button" id="sellAnother" class="btn btn-outline-primary btn-custom">Sell Another Product</button>
        <button type="button" id="returnDashboard" class="btn btn-outline-secondary btn-custom">Return to Dashboard</button>
      </div>
    </div>
  </form>
</section>

<!-- Footer -->
<footer>
  <div class="container">
    <p>&copy; 2025 Fake Product ID System | Seller Panel | Powered by Ethereum Blockchain</p>
  </div>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="js/web3.min.js"></script>
<script src="js/truffle-contract.js"></script>
<script src="js/main.js"></script>
<script src="js/sellProductSeller.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<script>
  function docReady(fn) {
    if (document.readyState === "complete" || document.readyState === "interactive") {
      setTimeout(fn, 1);
    } else {
      document.addEventListener("DOMContentLoaded", fn);
    }
  }

  docReady(function () {
    let lastResult = null;
    let countResults = 0;

    function onScanSuccess(decodedText, decodedResult) {
      if (decodedText !== lastResult) {
        ++countResults;
        lastResult = decodedText;

        const audio = new Audio('beep.wav');
        audio.play();

        $('#qr-reader-results').text(`Scanned Product SN: ${decodedText}`);
        $('#productSN').val(decodedText);
      }
    }

    const html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);
  });

  $('#sellProductForm').on('submit', function(e) {
    e.preventDefault();
    const consumerCode = $('#consumerCode').val().trim();
    const productSN = $('#productSN').val().trim();
    const statusDiv = $('#statusMessage');
    const postActions = $('#postActionBtns');

    if (!consumerCode) {
      statusDiv.text('⚠️ Please enter Consumer Code').css('color', 'red');
      postActions.hide();
      return;
    }
    if (!productSN) {
      statusDiv.text('⚠️ Please scan a product first').css('color', 'red');
      postActions.hide();
      return;
    }

    statusDiv.text(`✅ Product successfully assigned to consumer: ${consumerCode}!`).css('color', 'green');
    postActions.show();
  });

  $('#sellAnother').on('click', function() {
    $('#productSN').val('');
    $('#consumerCode').val('');
    $('#statusMessage').text('');
    $('#postActionBtns').hide();
    $('#qr-reader-results').text('');
  });

  $('#returnDashboard').on('click', function() {
    window.location.href = 'seller.html'; // Update if your dashboard page is named differently
  });
</script>

</body>
</html>
